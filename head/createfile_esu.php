<?php

session_set_cookie_params(0);
session_start();
@include '../config.php';
@include '../inactivity.php';
@include 'auth.php';
?>
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>ADD COLLEGE</title>
   <link rel="icon" href="../lib/img/reg.png">

   <link href="../lib/CSS/container.css" rel="stylesheet">

</head>
<style>
body {
  background-image: url('../lib/img/bg.png');
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;
}
</style>
<body>
   
<div class="form-container">



<form method="POST" action="<?php echo $_SERVER['PHP_SELF']; ?>">
    <img src="../lib/img/reg.png" width="150px" height="150px">
    <h3 style="color: red;"> REGISTRAR ARCHIVING</h3>
    <h4 style="text-align: left">Document Name:</h4>
    <input type="text" name="name" placeholder="Document Name" required maxlength="70"><br>
    <h4 style="text-align: left">Table Name for Database:</h4>
    <input type="text" id="table_name" name="table_name" required placeholder="Enter Table Name" maxlength="60"><br>
    <input type="hidden" name="href" id="href" value="" maxlength="70">
    <input type="hidden" name="tblname" id="tblname" value="" maxlength="70">
    <input type="hidden" name="Archhref" id="Archhref" value="" maxlength="70">
    <input type="submit" name="submit" value="Add Document" class="form-btn">
    <a href="javascript:history.back()"><input type="button" value="Back" class="form-btn"></input></a>
</form>

    <script>
    document.getElementById('table_name').addEventListener('input', function() {
        var tableName = document.getElementById('table_name').value;
        var hrefInput = document.getElementById('href');
        var archHrefInput = document.getElementById('Archhref');
        var tblInput = document.getElementById('tblname');
        hrefInput.value = "uploadesu/" + tableName + ".php";
        archHrefInput.value = "uploadesuarchive/" + tableName + ".php";
        tblInput.value = tableName;
    });
</script>
    <?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Database connection details
    $servername = "localhost";
    $username = "root";
    $password = "";
    $database = "archsys";

    // Create a new connection
    $conn = new mysqli($servername, $username, $password, $database);

    // Check the connection
    if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error);
    }

    // Get the table name from the form input
    $tableName = $_POST['table_name'];
    $name = $_POST['name'];

    // SQL query to create a table
    $sql = "CREATE TABLE $tableName (
        `id` int(15) NOT NULL AUTO_INCREMENT,
        `file_id` int(100) NOT NULL,
        `name` text NOT NULL,
        `image` longblob NOT NULL,
        `type` varchar(20) NOT NULL,
        `username` varchar(100) NOT NULL,
        `date` date NOT NULL,
        PRIMARY KEY (`id`)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4";
    
    

    // Execute the query
    if ($conn->query($sql) === TRUE) {
        echo "Table created successfully";
    
        // Generate a new PHP file for uploadmain
        $uploadMainFilename = "uploadesu/" . $_POST['table_name'] . ".php";
        $uploadMainContent = "<?php" . PHP_EOL . "session_set_cookie_params(0);" . PHP_EOL . "session_start();" . PHP_EOL . "@include '../../config.php';" . PHP_EOL . "@include '../../inactivity.php';" . PHP_EOL . "if(!isset(\$_SESSION['username']))" . PHP_EOL . "{" . PHP_EOL . "    header('location:../../login.php');" . PHP_EOL . "}" . PHP_EOL . "" . PHP_EOL . "elseif(\$_SESSION['usertype']=='User')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../user/');" . PHP_EOL . "}" . PHP_EOL . "elseif(\$_SESSION['usertype']=='Admin')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../admin/');" . PHP_EOL . "}" . PHP_EOL . "\$file_id=\$_GET['uploadid'];" . PHP_EOL . "?>" . PHP_EOL .
            "<!DOCTYPE html>" . PHP_EOL . "<html>" . PHP_EOL . "<?php include '../includes/uploadheader.php';?>" . PHP_EOL . "<body>" . PHP_EOL . "<section class='dashboard'>" . PHP_EOL . "    <div class='top'>" . PHP_EOL . "        <i class='bi bi-list sidebar-toggle'></i>" . PHP_EOL . "        <div class='search-box'>" . PHP_EOL . "            <i class='bi bi-person' style='font-size: 1.5rem; color: rgb(255, 0, 0);'></i>" . PHP_EOL . "            <input type='text' placeholder='<?php echo 'Welcome, ' . \$_SESSION['username'] . '! | ' . \$_SESSION['usertype'];?>' disabled>" . PHP_EOL . "        </div>" . PHP_EOL . "    </div>" . PHP_EOL . "    <div class='dash-content'>" . PHP_EOL . "        <div class='overview'>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='studprofile'>" . PHP_EOL . "            <a href='javascript:history.back()' style='display: inline-block;'>" . PHP_EOL . "                <button type='button' class='button'>" . PHP_EOL . "                    <span class='button__text'>Back</span>" . PHP_EOL . "                    <span class='button__icon'><svg xmlns='http://www.w3.org/2000/svg' width='24' viewBox='0 0 24 24' stroke-width='2' stroke-linejoin='round' stroke-linecap='round' stroke='currentColor' height='24' fill='none' class='svg'><polyline points='15 18 9 12 15 6'></polyline></svg></span>" . PHP_EOL .
            "                </button>" . PHP_EOL . "            </a>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='stud-image' align='center'>" . PHP_EOL . "            <img src='../../lib/img/user.png'>" . PHP_EOL . "            <?php" . PHP_EOL . "            @include '../../config.php';" . PHP_EOL . "            \$id=\$_GET['uploadid'];" . PHP_EOL . '            $select="select * from std_esu where id=$id";' . PHP_EOL . "            \$result = mysqli_query(\$conn, \$select);" .PHP_EOL . "                 if(\$result){" .PHP_EOL . "                     while(\$row=mysqli_fetch_assoc(\$result)){" .PHP_EOL . "                        \$lname = \$row['lname'];" .PHP_EOL. "                        \$fname = \$row['fname'];" .PHP_EOL. "                        \$mname = \$row['mname'];" .PHP_EOL. "                        \$courname = \$row['courname'];" .PHP_EOL. "                        echo '" .PHP_EOL. "                        <p><b>'.\$lname.', '.\$fname.' '.\$mname.'</b></p>" .PHP_EOL. "                        <p><b>'.\$courname.'</b></p>" .PHP_EOL. "                        ';" .PHP_EOL. "                     }" .PHP_EOL. "                    }" .PHP_EOL. "                ?>" .PHP_EOL. "                <p>E.S.U</p>" .PHP_EOL. "                <br>  " .PHP_EOL.  "                <p><b>($name)</b></p> " .PHP_EOL.'        <form action="" method="post" enctype="multipart/form-data" id="uploadForm">' .PHP_EOL. '                <input type="hidden" name="file_id" id="file_id" required value="<?php echo $id ?>">' .PHP_EOL. '                <input class="form-control" type="file" name="image" id="image" required/>' .PHP_EOL. $input = '<input type="hidden" name="username" value="<?php echo $_SESSION[\'username\']; ?>">' . PHP_EOL.
 '<input type="hidden" name="date" id="theDate">  ' .PHP_EOL. '                <button class="buttonDownload" type="button" onclick="confirmUpload()">Upload</button>' .PHP_EOL. "        </form>" .PHP_EOL. "        </div>" .PHP_EOL. "        <style>" .PHP_EOL. ".form-label strong {" .PHP_EOL. "  font-weight: bold;" .PHP_EOL. "  font-size: 1.2em;" .PHP_EOL. "  color: #333;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".form-control {" .PHP_EOL. "  display: block;" .PHP_EOL. "  width: 20%;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  line-height: 1.5;" .PHP_EOL. "  color: #495057;" .PHP_EOL. "  background-color: #fff;" .PHP_EOL. "  border: 1px solid #ced4da;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".form-control:focus {" .PHP_EOL. "  border-color: #80bdff;" .PHP_EOL. "  outline: 0;" .PHP_EOL. "  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);" .PHP_EOL. "}" .PHP_EOL. 'input[type="file"] {' .PHP_EOL. "  display: block;" .PHP_EOL. "  width: 20%;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  line-height: 1.5;" .PHP_EOL. "  color: #495057;" .PHP_EOL. "  background-color: #fff;" .PHP_EOL. "  border: 1px solid #ced4da;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "  box-shadow: none;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. 'input[type="file"]::-webkit-file-upload-button {' .PHP_EOL. "  background-color: crimson;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  border: none;" .PHP_EOL. "  color: #fff;" .PHP_EOL. "  cursor: pointer;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  transition: background-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "}" .PHP_EOL.
    'input[type="file"]::-webkit-file-upload-button:hover {' .PHP_EOL. "  background-color: black;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. 'input[type="file"]::-webkit-file-upload-button:focus {' .PHP_EOL. "  outline: none;" .PHP_EOL. "  box-shadow: none;" .PHP_EOL. "}" .PHP_EOL. ".buttonDownload {" .PHP_EOL. "  display: inline-block;" .PHP_EOL. "  position: relative;" .PHP_EOL. "  padding: 10px 25px;" .PHP_EOL. "  background-color: crimson;" .PHP_EOL. "  color: white;" .PHP_EOL. "  font-family: sans-serif;" .PHP_EOL. "  text-decoration: none;" .PHP_EOL. "  font-size: 0.9em;" .PHP_EOL. "  text-align: center;" .PHP_EOL. "  text-indent: 15px;" .PHP_EOL. "  border: none;" .PHP_EOL. "  border-radius: 0.3em;" .PHP_EOL. "  font-weight: bold;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover {" .PHP_EOL. "  color: white;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:before, .buttonDownload:after {" .PHP_EOL. "  content: ' ';" .PHP_EOL. "  display: block;" .PHP_EOL. "  position: absolute;" .PHP_EOL. "  left: 15px;" .PHP_EOL. "  top: 52%;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:before {" .PHP_EOL. "  width: 10px;" .PHP_EOL. "  height: 2px;" .PHP_EOL. "  border-style: solid;" .PHP_EOL. "  border-width: 0 2px 2px;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:after {" .PHP_EOL. "  width: 0;" .PHP_EOL. "  height: 0;" .PHP_EOL. "  margin-left: 3px;" .PHP_EOL. "  margin-top: -7px;" .PHP_EOL. "  border-style: solid;" .PHP_EOL. "  border-width: 4px 4px 0 4px;" .PHP_EOL. "  border-color: transparent;" .PHP_EOL. "  border-top-color: inherit;" .PHP_EOL. "  animation: downloadArrow 1s linear infinite;" .PHP_EOL. "  animation-play-state: paused;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover:before {" .PHP_EOL. "  border-color: white;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover:after {" .PHP_EOL. "  border-top-color: white;" .PHP_EOL. "  animation-play-state: running;" .PHP_EOL.
        "}" .PHP_EOL. " " .PHP_EOL. "@keyframes downloadArrow {" .PHP_EOL. "  0% {" .PHP_EOL. "    margin-top: -7px;" .PHP_EOL. "    opacity: 1;" .PHP_EOL. "  }" .PHP_EOL. " " .PHP_EOL. "  0.001% {" .PHP_EOL. "    margin-top: -15px;" .PHP_EOL. "    opacity: 0.4;" .PHP_EOL. "  }" .PHP_EOL. "  50% {" .PHP_EOL. "    opacity: 1;" .PHP_EOL. "  }" .PHP_EOL. "  100% {" .PHP_EOL. "    margin-top: 0;" .PHP_EOL. "    opacity: 0.4;" .PHP_EOL. "  }" .PHP_EOL. "}" .PHP_EOL. "</style>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. '    <div class="row">' .PHP_EOL. '        <div class="col-xs-8 col-xs-offset-2">' .PHP_EOL. "        <?php" .PHP_EOL. " " .PHP_EOL. 'if(isset($_FILES["image"])) {' .PHP_EOL. '    $image = $_FILES["image"];' .PHP_EOL. '    $file_id = $_POST["file_id"];' .PHP_EOL. '    $username = $_POST["username"];' .PHP_EOL. "    \$date = \$_POST['date'];" .PHP_EOL. '    $name = $image["name"];' .PHP_EOL. '    $type = $image["type"];' .PHP_EOL. " " .PHP_EOL. '    if($type != "application/pdf" && $type != "image/jpeg") {' .PHP_EOL. $script = 'echo \'<script src="../../lib/JS/sweetalert.min.js"></script>\';' . PHP_EOL. $script = '        echo "<script>";' . PHP_EOL. $script = '        echo "swal({' . PHP_EOL. "            title: 'Error!'," .PHP_EOL. "            text: 'Only PDF and JPEG files are allowed.', " .PHP_EOL. "            icon: 'error' " .PHP_EOL. "        }).then(function() {" .PHP_EOL. "            window.history.back();" .PHP_EOL. '        });";' .PHP_EOL. '        echo "</script>";' .PHP_EOL. "        exit();" .PHP_EOL. "    }" .PHP_EOL. " " .PHP_EOL. '    $blob = addslashes(file_get_contents($image["tmp_name"]));' .PHP_EOL. $sql = "       \$sql = \"INSERT INTO `" . $tableName . "` (`image`, `file_id`, `username`, `date`, `name`, `type`) VALUES ('\" . \$blob . \"', '\" . \$file_id . \"' , '\" . \$username . \"', '\" . \$date . \"', '\" . \$name . \"' , '\" . \$type . \"')\";" . PHP_EOL. "    mysqli_query(\$conn, \$sql) or die(mysqli_error(\$conn));" .PHP_EOL. $script = 'echo \'<script src="../../lib/JS/sweetalert.min.js"></script>\';' . PHP_EOL. $script = '        echo "<script>";' . PHP_EOL. $script = '        echo "swal({' . PHP_EOL. "        title: 'Success!', " .PHP_EOL. "        text: 'File has been uploaded.', " .PHP_EOL. "        icon: 'success' " .PHP_EOL. "    }).then(function() {" .PHP_EOL. "        window.history.back();" .PHP_EOL. '    });";' .PHP_EOL. '    echo "</script>";' .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. $sql = "\$sql = \"SELECT id, name FROM `" . $tableName . "` WHERE file_id=\$file_id\";" . PHP_EOL. '$result = mysqli_query($conn, $sql);' .PHP_EOL. "?>" .PHP_EOL.  '<script src="../../lib/JS/sweetalert.min.js"></script>' .PHP_EOL. "<script>" .PHP_EOL. "function confirmUpload() {" .PHP_EOL. "    swal({" .PHP_EOL. '        title: "Confirmation",' .PHP_EOL. '        text: "Are you sure you want to upload the file?",' .PHP_EOL. '        icon: "warning",' .PHP_EOL. '        buttons: ["Cancel", "Upload"],' .PHP_EOL. "        dangerMode: true," .PHP_EOL. "    }).then(function (willUpload) {" .PHP_EOL. "        if (willUpload) {" .PHP_EOL. '            document.getElementById("uploadForm").submit();' .PHP_EOL. "        } else {" .PHP_EOL. "            swal({" .PHP_EOL. '                title: "Cancelled",' .PHP_EOL. '                text: "File upload has been cancelled.",' .PHP_EOL. '                icon: "info",' .PHP_EOL. "            });" .PHP_EOL. "        }" .PHP_EOL. "    });" .PHP_EOL. '' .PHP_EOL. "}" .PHP_EOL. "</script>" .PHP_EOL. " " .PHP_EOL. '<table class="content-table">' .PHP_EOL. "    <thead>" .PHP_EOL. "        <tr>" .PHP_EOL. "            <th>File Name</th>" .PHP_EOL. "            <th>View</th>" .PHP_EOL.  "            <th>Delete</th>" .PHP_EOL. "        </tr>" .PHP_EOL. "    </thead>" .PHP_EOL. "    <tbody>" .PHP_EOL. "        <?php" .PHP_EOL. '        while ($row = mysqli_fetch_object($result))' .PHP_EOL. "        {" .PHP_EOL.
            "            ?>" .PHP_EOL. "            <tr>" .PHP_EOL. '                <td><?php echo $row->name; ?></td>' .PHP_EOL. "                <td>" .PHP_EOL. "                   <a href=\"../views/$tableName.php?id=<?php echo \$row->id; ?>\" target=\"_blank\"> ".PHP_EOL. '                        <buttons class="btn-button">VIEW</buttons>' .PHP_EOL. "                    </a>" .PHP_EOL. "                </td>" .PHP_EOL. "            <td>" .PHP_EOL. "                <a class=\"btn-button\" href=\"delete/delete_$tableName.php?id=<?php echo \$row->id; ?>\" onclick=\"showConfirmation(event)\">DELETE</a>" .PHP_EOL.  "            </td>" .PHP_EOL. "            </tr>" .PHP_EOL. "            <?php" .PHP_EOL. "        }" .PHP_EOL. "        ?>" .PHP_EOL. "    </tbody>" .PHP_EOL. "</table>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. "</div>" .PHP_EOL. "</section>" .PHP_EOL. "<script>" .PHP_EOL. "    function showConfirmation(event) {" .PHP_EOL. "        event.preventDefault();" .PHP_EOL. " " .PHP_EOL. "        swal({" .PHP_EOL. "            title: 'Are you sure?'," .PHP_EOL. "            text: 'This action cannot be undone.'," .PHP_EOL. "            icon: 'warning'," .PHP_EOL. "            buttons: {" .PHP_EOL. "                cancel: {" .PHP_EOL. "                    text: 'Cancel'," .PHP_EOL. "                    value: null," .PHP_EOL. "                   visible: true," .PHP_EOL. "                    className: ''," .PHP_EOL. "                    closeModal: true," .PHP_EOL. "                }," .PHP_EOL. "                confirm: {" .PHP_EOL. "                    text: 'Yes, delete it!'," .PHP_EOL. "                    value: true," .PHP_EOL. "                    visible: true," .PHP_EOL. "                    className: ''," .PHP_EOL. "                    closeModal: true" .PHP_EOL. 
                "                }" .PHP_EOL. "            }" .PHP_EOL. "        }).then(function (willDelete) {" .PHP_EOL. "            if (willDelete) {" .PHP_EOL. "                window.location.href = event.target.href;" .PHP_EOL. "                showSuccessMessage();" .PHP_EOL. "            }" .PHP_EOL. "        });" .PHP_EOL. "    }" .PHP_EOL. " " .PHP_EOL. "    function showSuccessMessage() {" .PHP_EOL. "        swal({" .PHP_EOL. "            title: 'Deleted!'," .PHP_EOL. "            text: 'The record has been deleted successfully.'," .PHP_EOL. "            icon: 'success'," .PHP_EOL. "            timer: 2000," .PHP_EOL. "            buttons: false," .PHP_EOL. "        }).then(function () {" .PHP_EOL. "            window.location.href = 'birth.php';" .PHP_EOL. "        });" .PHP_EOL. "    }" .PHP_EOL. "</script>" .PHP_EOL. "<script>" .PHP_EOL. "    var date = new Date();" .PHP_EOL. "var day = date.getDate();" .PHP_EOL. "var month = date.getMonth() + 1;" .PHP_EOL. "var year = date.getFullYear();" .PHP_EOL. " " .PHP_EOL. 'if (month < 10) month = "0" + month;' .PHP_EOL. 'if (day < 10) day = "0" + day;' .PHP_EOL. " " .PHP_EOL. 'var today = year + "-" + month + "-" + day; ' .PHP_EOL. 'document.getElementById("theDate").value = today;' .PHP_EOL. "</script>" .PHP_EOL. "<script>" .PHP_EOL. '    const form = document.querySelector("form"),' .PHP_EOL. '        nextBtn = form.querySelector(".nextBtn"),' .PHP_EOL. '        backBtn = form.querySelector(".backBtn"),' .PHP_EOL. '        allInput = form.querySelectorAll(".first input");' .PHP_EOL. " " .PHP_EOL. 'nextBtn.addEventListener("click", ()=> {' .PHP_EOL. "    allInput.forEach(input => {" .PHP_EOL. '        if(input.value != ""){' .PHP_EOL. "            form.classList.add('secActive');" .PHP_EOL. "        }else{" .PHP_EOL. "            form.classList.remove('secActive');" .PHP_EOL. "        }" .PHP_EOL. "    })" .PHP_EOL. "})" .PHP_EOL. " " .PHP_EOL. "backBtn.addEventListener(\"click\", () => form.classList.remove('secActive'));" .PHP_EOL. "</script> " .PHP_EOL. '<script src="../../lib/JS/script.js"></script>' .PHP_EOL. "</body>" .PHP_EOL. "</html>" .PHP_EOL."";
            if (file_put_contents($uploadMainFilename, $uploadMainContent) !== false) {
                echo "uploadmain PHP file created successfully";
            } else {
                echo "Error creating uploadmain PHP file";
            }

            $uploadAdminMainFilename = "../admin/uploadesu/" . $_POST['table_name'] . ".php";
            $uploadAdminMainContent = "<?php" . PHP_EOL . "session_set_cookie_params(0);" . PHP_EOL . "session_start();" . PHP_EOL . "@include '../../config.php';" . PHP_EOL . "@include '../../inactivity.php';" . PHP_EOL . "if(!isset(\$_SESSION['username']))" . PHP_EOL . "{" . PHP_EOL . "    header('location:../../login.php');" . PHP_EOL . "}" . PHP_EOL . "" . PHP_EOL . "elseif(\$_SESSION['usertype']=='User')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../user/');" . PHP_EOL . "}" . PHP_EOL . "elseif(\$_SESSION['usertype']=='HeadAdmin')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../head/');" . PHP_EOL . "}" . PHP_EOL . "\$file_id=\$_GET['uploadid'];" . PHP_EOL . "?>" . PHP_EOL .
                "<!DOCTYPE html>" . PHP_EOL . "<html>" . PHP_EOL . "<?php include '../includes/uploadheader.php';?>" . PHP_EOL . "<body>" . PHP_EOL . "<section class='dashboard'>" . PHP_EOL . "    <div class='top'>" . PHP_EOL . "        <i class='bi bi-list sidebar-toggle'></i>" . PHP_EOL . "        <div class='search-box'>" . PHP_EOL . "            <i class='bi bi-person' style='font-size: 1.5rem; color: rgb(255, 0, 0);'></i>" . PHP_EOL . "            <input type='text' placeholder='<?php echo 'Welcome, ' . \$_SESSION['username'] . '! | ' . \$_SESSION['usertype'];?>' disabled>" . PHP_EOL . "        </div>" . PHP_EOL . "    </div>" . PHP_EOL . "    <div class='dash-content'>" . PHP_EOL . "        <div class='overview'>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='studprofile'>" . PHP_EOL . "            <a href='javascript:history.back()' style='display: inline-block;'>" . PHP_EOL . "                <button type='button' class='button'>" . PHP_EOL . "                    <span class='button__text'>Back</span>" . PHP_EOL . "                    <span class='button__icon'><svg xmlns='http://www.w3.org/2000/svg' width='24' viewBox='0 0 24 24' stroke-width='2' stroke-linejoin='round' stroke-linecap='round' stroke='currentColor' height='24' fill='none' class='svg'><polyline points='15 18 9 12 15 6'></polyline></svg></span>" . PHP_EOL .
                "                </button>" . PHP_EOL . "            </a>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='stud-image' align='center'>" . PHP_EOL . "            <img src='../../lib/img/user.png'>" . PHP_EOL . "            <?php" . PHP_EOL . "            @include '../../config.php';" . PHP_EOL . "            \$id=\$_GET['uploadid'];" . PHP_EOL . '            $select="select * from std_esu where id=$id";' . PHP_EOL . "            \$result = mysqli_query(\$conn, \$select);" .PHP_EOL . "                 if(\$result){" .PHP_EOL . "                     while(\$row=mysqli_fetch_assoc(\$result)){" .PHP_EOL . "                        \$lname = \$row['lname'];" .PHP_EOL. "                        \$fname = \$row['fname'];" .PHP_EOL. "                        \$mname = \$row['mname'];" .PHP_EOL. "                        \$courname = \$row['courname'];" .PHP_EOL. "                        echo '" .PHP_EOL. "                        <p><b>'.\$lname.', '.\$fname.' '.\$mname.'</b></p>" .PHP_EOL. "                        <p><b>'.\$courname.'</b></p>" .PHP_EOL. "                        ';" .PHP_EOL. "                     }" .PHP_EOL. "                    }" .PHP_EOL. "                ?>" .PHP_EOL. "                <p>E.S.U</p>" .PHP_EOL. "                <br>  " .PHP_EOL.  "                <p><b>($name)</b></p> " .PHP_EOL.'        <form action="" method="post" enctype="multipart/form-data" id="uploadForm">' .PHP_EOL. '                <input type="hidden" name="file_id" id="file_id" required value="<?php echo $id ?>">' .PHP_EOL. '                <input class="form-control" type="file" name="image" id="image" required/>' .PHP_EOL. $input = '<input type="hidden" name="username" value="<?php echo $_SESSION[\'username\']; ?>">' . PHP_EOL.
     '<input type="hidden" name="date" id="theDate">  ' .PHP_EOL. '                <button class="buttonDownload" type="button" onclick="confirmUpload()">Upload</button>' .PHP_EOL. "        </form>" .PHP_EOL. "        </div>" .PHP_EOL. "        <style>" .PHP_EOL. ".form-label strong {" .PHP_EOL. "  font-weight: bold;" .PHP_EOL. "  font-size: 1.2em;" .PHP_EOL. "  color: #333;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".form-control {" .PHP_EOL. "  display: block;" .PHP_EOL. "  width: 20%;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  line-height: 1.5;" .PHP_EOL. "  color: #495057;" .PHP_EOL. "  background-color: #fff;" .PHP_EOL. "  border: 1px solid #ced4da;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".form-control:focus {" .PHP_EOL. "  border-color: #80bdff;" .PHP_EOL. "  outline: 0;" .PHP_EOL. "  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);" .PHP_EOL. "}" .PHP_EOL. 'input[type="file"] {' .PHP_EOL. "  display: block;" .PHP_EOL. "  width: 20%;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  line-height: 1.5;" .PHP_EOL. "  color: #495057;" .PHP_EOL. "  background-color: #fff;" .PHP_EOL. "  border: 1px solid #ced4da;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "  box-shadow: none;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. 'input[type="file"]::-webkit-file-upload-button {' .PHP_EOL. "  background-color: crimson;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  border: none;" .PHP_EOL. "  color: #fff;" .PHP_EOL. "  cursor: pointer;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  transition: background-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "}" .PHP_EOL.
        'input[type="file"]::-webkit-file-upload-button:hover {' .PHP_EOL. "  background-color: black;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. 'input[type="file"]::-webkit-file-upload-button:focus {' .PHP_EOL. "  outline: none;" .PHP_EOL. "  box-shadow: none;" .PHP_EOL. "}" .PHP_EOL. ".buttonDownload {" .PHP_EOL. "  display: inline-block;" .PHP_EOL. "  position: relative;" .PHP_EOL. "  padding: 10px 25px;" .PHP_EOL. "  background-color: crimson;" .PHP_EOL. "  color: white;" .PHP_EOL. "  font-family: sans-serif;" .PHP_EOL. "  text-decoration: none;" .PHP_EOL. "  font-size: 0.9em;" .PHP_EOL. "  text-align: center;" .PHP_EOL. "  text-indent: 15px;" .PHP_EOL. "  border: none;" .PHP_EOL. "  border-radius: 0.3em;" .PHP_EOL. "  font-weight: bold;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover {" .PHP_EOL. "  color: white;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:before, .buttonDownload:after {" .PHP_EOL. "  content: ' ';" .PHP_EOL. "  display: block;" .PHP_EOL. "  position: absolute;" .PHP_EOL. "  left: 15px;" .PHP_EOL. "  top: 52%;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:before {" .PHP_EOL. "  width: 10px;" .PHP_EOL. "  height: 2px;" .PHP_EOL. "  border-style: solid;" .PHP_EOL. "  border-width: 0 2px 2px;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:after {" .PHP_EOL. "  width: 0;" .PHP_EOL. "  height: 0;" .PHP_EOL. "  margin-left: 3px;" .PHP_EOL. "  margin-top: -7px;" .PHP_EOL. "  border-style: solid;" .PHP_EOL. "  border-width: 4px 4px 0 4px;" .PHP_EOL. "  border-color: transparent;" .PHP_EOL. "  border-top-color: inherit;" .PHP_EOL. "  animation: downloadArrow 1s linear infinite;" .PHP_EOL. "  animation-play-state: paused;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover:before {" .PHP_EOL. "  border-color: white;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover:after {" .PHP_EOL. "  border-top-color: white;" .PHP_EOL. "  animation-play-state: running;" .PHP_EOL.
            "}" .PHP_EOL. " " .PHP_EOL. "@keyframes downloadArrow {" .PHP_EOL. "  0% {" .PHP_EOL. "    margin-top: -7px;" .PHP_EOL. "    opacity: 1;" .PHP_EOL. "  }" .PHP_EOL. " " .PHP_EOL. "  0.001% {" .PHP_EOL. "    margin-top: -15px;" .PHP_EOL. "    opacity: 0.4;" .PHP_EOL. "  }" .PHP_EOL. "  50% {" .PHP_EOL. "    opacity: 1;" .PHP_EOL. "  }" .PHP_EOL. "  100% {" .PHP_EOL. "    margin-top: 0;" .PHP_EOL. "    opacity: 0.4;" .PHP_EOL. "  }" .PHP_EOL. "}" .PHP_EOL. "</style>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. '    <div class="row">' .PHP_EOL. '        <div class="col-xs-8 col-xs-offset-2">' .PHP_EOL. "        <?php" .PHP_EOL. " " .PHP_EOL. 'if(isset($_FILES["image"])) {' .PHP_EOL. '    $image = $_FILES["image"];' .PHP_EOL. '    $file_id = $_POST["file_id"];' .PHP_EOL. '    $username = $_POST["username"];' .PHP_EOL. "    \$date = \$_POST['date'];" .PHP_EOL. '    $name = $image["name"];' .PHP_EOL. '    $type = $image["type"];' .PHP_EOL. " " .PHP_EOL. '    if($type != "application/pdf" && $type != "image/jpeg") {' .PHP_EOL. $script = 'echo \'<script src="../../lib/JS/sweetalert.min.js"></script>\';' . PHP_EOL. $script = '        echo "<script>";' . PHP_EOL. $script = '        echo "swal({' . PHP_EOL. "            title: 'Error!'," .PHP_EOL. "            text: 'Only PDF and JPEG files are allowed.', " .PHP_EOL. "            icon: 'error' " .PHP_EOL. "        }).then(function() {" .PHP_EOL. "            window.history.back();" .PHP_EOL. '        });";' .PHP_EOL. '        echo "</script>";' .PHP_EOL. "        exit();" .PHP_EOL. "    }" .PHP_EOL. " " .PHP_EOL. '    $blob = addslashes(file_get_contents($image["tmp_name"]));' .PHP_EOL. $sql = "       \$sql = \"INSERT INTO `" . $tableName . "` (`image`, `file_id`, `username`, `date`, `name`, `type`) VALUES ('\" . \$blob . \"', '\" . \$file_id . \"' , '\" . \$username . \"', '\" . \$date . \"', '\" . \$name . \"' , '\" . \$type . \"')\";" . PHP_EOL. "    mysqli_query(\$conn, \$sql) or die(mysqli_error(\$conn));" .PHP_EOL. $script = 'echo \'<script src="../../lib/JS/sweetalert.min.js"></script>\';' . PHP_EOL. $script = '        echo "<script>";' . PHP_EOL. $script = '        echo "swal({' . PHP_EOL. "        title: 'Success!', " .PHP_EOL. "        text: 'File has been uploaded.', " .PHP_EOL. "        icon: 'success' " .PHP_EOL. "    }).then(function() {" .PHP_EOL. "        window.history.back();" .PHP_EOL. '    });";' .PHP_EOL. '    echo "</script>";' .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. $sql = "\$sql = \"SELECT id, name FROM `" . $tableName . "` WHERE file_id=\$file_id\";" . PHP_EOL. '$result = mysqli_query($conn, $sql);' .PHP_EOL. "?>" .PHP_EOL.  '<script src="../../lib/JS/sweetalert.min.js"></script>' .PHP_EOL. "<script>" .PHP_EOL. "function confirmUpload() {" .PHP_EOL. "    swal({" .PHP_EOL. '        title: "Confirmation",' .PHP_EOL. '        text: "Are you sure you want to upload the file?",' .PHP_EOL. '        icon: "warning",' .PHP_EOL. '        buttons: ["Cancel", "Upload"],' .PHP_EOL. "        dangerMode: true," .PHP_EOL. "    }).then(function (willUpload) {" .PHP_EOL. "        if (willUpload) {" .PHP_EOL. '            document.getElementById("uploadForm").submit();' .PHP_EOL. "        } else {" .PHP_EOL. "            swal({" .PHP_EOL. '                title: "Cancelled",' .PHP_EOL. '                text: "File upload has been cancelled.",' .PHP_EOL. '                icon: "info",' .PHP_EOL. "            });" .PHP_EOL. "        }" .PHP_EOL. "    });" .PHP_EOL. '' .PHP_EOL. "}" .PHP_EOL. "</script>" .PHP_EOL." " .PHP_EOL. '<table class="content-table">' .PHP_EOL. "    <thead>" .PHP_EOL. "        <tr>" .PHP_EOL. "            <th>File Name</th>" .PHP_EOL. "            <th>View</th>" .PHP_EOL."        </tr>" .PHP_EOL. "    </thead>" .PHP_EOL. "    <tbody>" .PHP_EOL. "        <?php" .PHP_EOL. '        while ($row = mysqli_fetch_object($result))' .PHP_EOL. "        {" .PHP_EOL.
                "            ?>" .PHP_EOL. "            <tr>" .PHP_EOL. '                <td><?php echo $row->name; ?></td>' .PHP_EOL. "                <td>" .PHP_EOL. "                   <a href=\"../views/$tableName.php?id=<?php echo \$row->id; ?>\" target=\"_blank\"> ".PHP_EOL. '                        <buttons class="btn-button">VIEW</buttons>' .PHP_EOL. "                    </a>" .PHP_EOL. "                </td>" .PHP_EOL. "            </tr>" .PHP_EOL. "            <?php" .PHP_EOL. "        }" .PHP_EOL. "        ?>" .PHP_EOL. "    </tbody>" .PHP_EOL. "</table>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. "</div>" .PHP_EOL. "</section>" .PHP_EOL. "<script>" .PHP_EOL. "    var date = new Date();" .PHP_EOL. "var day = date.getDate();" .PHP_EOL. "var month = date.getMonth() + 1;" .PHP_EOL. "var year = date.getFullYear();" .PHP_EOL. " " .PHP_EOL. 'if (month < 10) month = "0" + month;' .PHP_EOL. 'if (day < 10) day = "0" + day;' .PHP_EOL. " " .PHP_EOL. 'var today = year + "-" + month + "-" + day; ' .PHP_EOL. 'document.getElementById("theDate").value = today;' .PHP_EOL. "</script>" .PHP_EOL. "<script>" .PHP_EOL. '    const form = document.querySelector("form"),' .PHP_EOL. '        nextBtn = form.querySelector(".nextBtn"),' .PHP_EOL. '        backBtn = form.querySelector(".backBtn"),' .PHP_EOL. '        allInput = form.querySelectorAll(".first input");' .PHP_EOL. " " .PHP_EOL. 'nextBtn.addEventListener("click", ()=> {' .PHP_EOL. "    allInput.forEach(input => {" .PHP_EOL. '        if(input.value != ""){' .PHP_EOL. "            form.classList.add('secActive');" .PHP_EOL. "        }else{" .PHP_EOL. "            form.classList.remove('secActive');" .PHP_EOL. "        }" .PHP_EOL. "    })" .PHP_EOL. "})" .PHP_EOL. " " .PHP_EOL. "backBtn.addEventListener(\"click\", () => form.classList.remove('secActive'));" .PHP_EOL. "</script> " .PHP_EOL. '<script src="../../lib/JS/script.js"></script>' .PHP_EOL. "</body>" .PHP_EOL. "</html>" .PHP_EOL."";
                if (file_put_contents($uploadAdminMainFilename, $uploadAdminMainContent) !== false) {
                    echo "uploadmain PHP file created successfully";
                } else {
                    echo "Error creating uploadmain PHP file";
                }
        
        $uploadUserMainFilename = "../user/uploadesu/" . $_POST['table_name'] . ".php";
        $uploadUserMainContent = "<?php" . PHP_EOL . "session_set_cookie_params(0);" . PHP_EOL . "session_start();" . PHP_EOL . "@include '../../config.php';" . PHP_EOL . "@include '../../inactivity.php';" . PHP_EOL . "if(!isset(\$_SESSION['username']))" . PHP_EOL . "{" . PHP_EOL . "    header('location:../../login.php');" . PHP_EOL . "}" . PHP_EOL . "" . PHP_EOL . "elseif(\$_SESSION['usertype']=='HeadAdmin')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../head/');" . PHP_EOL . "}" . PHP_EOL . "elseif(\$_SESSION['usertype']=='Admin')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../admin/');" . PHP_EOL . "}" . PHP_EOL . "\$file_id=\$_GET['uploadid'];" . PHP_EOL . "?>" . PHP_EOL .
            "<!DOCTYPE html>" . PHP_EOL . "<html>" . PHP_EOL . "<?php include '../includes/uploadheader.php';?>" . PHP_EOL . "<body>" . PHP_EOL . "<section class='dashboard'>" . PHP_EOL . "    <div class='top'>" . PHP_EOL . "        <i class='bi bi-list sidebar-toggle'></i>" . PHP_EOL . "        <div class='search-box'>" . PHP_EOL . "            <i class='bi bi-person' style='font-size: 1.5rem; color: rgb(255, 0, 0);'></i>" . PHP_EOL . "            <input type='text' placeholder='<?php echo 'Welcome, ' . \$_SESSION['username'] . '! | ' . \$_SESSION['usertype'];?>' disabled>" . PHP_EOL . "        </div>" . PHP_EOL . "    </div>" . PHP_EOL . "    <div class='dash-content'>" . PHP_EOL . "        <div class='overview'>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='studprofile'>" . PHP_EOL . "            <a href='javascript:history.back()' style='display: inline-block;'>" . PHP_EOL . "                <button type='button' class='button'>" . PHP_EOL . "                    <span class='button__text'>Back</span>" . PHP_EOL . "                    <span class='button__icon'><svg xmlns='http://www.w3.org/2000/svg' width='24' viewBox='0 0 24 24' stroke-width='2' stroke-linejoin='round' stroke-linecap='round' stroke='currentColor' height='24' fill='none' class='svg'><polyline points='15 18 9 12 15 6'></polyline></svg></span>" . PHP_EOL .
            "                </button>" . PHP_EOL . "            </a>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='stud-image' align='center'>" . PHP_EOL . "            <img src='../../lib/img/user.png'>" . PHP_EOL . "            <?php" . PHP_EOL . "            @include '../../config.php';" . PHP_EOL . "            \$id=\$_GET['uploadid'];" . PHP_EOL . '            $select="select * from std_esu where id=$id";' . PHP_EOL . "            \$result = mysqli_query(\$conn, \$select);" .PHP_EOL . "                 if(\$result){" .PHP_EOL . "                     while(\$row=mysqli_fetch_assoc(\$result)){" .PHP_EOL . "                        \$lname = \$row['lname'];" .PHP_EOL. "                        \$fname = \$row['fname'];" .PHP_EOL. "                        \$mname = \$row['mname'];" .PHP_EOL. "                        \$courname = \$row['courname'];" .PHP_EOL. "                        echo '" .PHP_EOL. "                        <p><b>'.\$lname.', '.\$fname.' '.\$mname.'</b></p>" .PHP_EOL. "                        <p><b>'.\$courname.'</b></p>" .PHP_EOL. "                        ';" .PHP_EOL. "                     }" .PHP_EOL. "                    }" .PHP_EOL. "                ?>" .PHP_EOL. "                <p>E.S.U</p>" .PHP_EOL. "                <br>  " .PHP_EOL.  "                <p><b>($name)</b></p> " .PHP_EOL. "        </div>" .PHP_EOL."        </div>" .PHP_EOL. "    </div>" .PHP_EOL. '    <div class="row">' .PHP_EOL. '        <div class="col-xs-8 col-xs-offset-2">' .PHP_EOL. "<?php" .PHP_EOL. $sql = "\$sql = \"SELECT id, name FROM `" . $tableName . "` WHERE file_id=\$file_id\";" . PHP_EOL. '$result = mysqli_query($conn, $sql);' .PHP_EOL. "?>" .PHP_EOL." " .PHP_EOL. '<table class="content-table">' .PHP_EOL. "    <thead>" .PHP_EOL. "        <tr>" .PHP_EOL. "            <th>File Name</th>" .PHP_EOL. "            <th>View</th>" .PHP_EOL."        </tr>" .PHP_EOL. "    </thead>" .PHP_EOL. "    <tbody>" .PHP_EOL. "        <?php" .PHP_EOL. '        while ($row = mysqli_fetch_object($result))' .PHP_EOL. "        {" .PHP_EOL.
            "            ?>" .PHP_EOL. "            <tr>" .PHP_EOL. '                <td><?php echo $row->name; ?></td>' .PHP_EOL. "                <td>" .PHP_EOL. "                   <a href=\"../views/$tableName.php?id=<?php echo \$row->id; ?>\" target=\"_blank\"> ".PHP_EOL. '                        <buttons class="btn-button">VIEW</buttons>' .PHP_EOL. "                    </a>" .PHP_EOL. "                </td>" .PHP_EOL."            </tr>" .PHP_EOL. "            <?php" .PHP_EOL. "        }" .PHP_EOL. "        ?>" .PHP_EOL. "    </tbody>" .PHP_EOL. "</table>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. "</div>" .PHP_EOL. "</section>" .PHP_EOL. "<script>" .PHP_EOL. "    var date = new Date();" .PHP_EOL. "var day = date.getDate();" .PHP_EOL. "var month = date.getMonth() + 1;" .PHP_EOL. "var year = date.getFullYear();" .PHP_EOL. " " .PHP_EOL. 'if (month < 10) month = "0" + month;' .PHP_EOL. 'if (day < 10) day = "0" + day;' .PHP_EOL. " " .PHP_EOL. 'var today = year + "-" + month + "-" + day; ' .PHP_EOL. 'document.getElementById("theDate").value = today;' .PHP_EOL. "</script>" .PHP_EOL. "<script>" .PHP_EOL. '    const form = document.querySelector("form"),' .PHP_EOL. '        nextBtn = form.querySelector(".nextBtn"),' .PHP_EOL. '        backBtn = form.querySelector(".backBtn"),' .PHP_EOL. '        allInput = form.querySelectorAll(".first input");' .PHP_EOL. " " .PHP_EOL. 'nextBtn.addEventListener("click", ()=> {' .PHP_EOL. "    allInput.forEach(input => {" .PHP_EOL. '        if(input.value != ""){' .PHP_EOL. "            form.classList.add('secActive');" .PHP_EOL. "        }else{" .PHP_EOL. "            form.classList.remove('secActive');" .PHP_EOL. "        }" .PHP_EOL. "    })" .PHP_EOL. "})" .PHP_EOL. " " .PHP_EOL. "backBtn.addEventListener(\"click\", () => form.classList.remove('secActive'));" .PHP_EOL. "</script> " .PHP_EOL. '<script src="../../lib/JS/script.js"></script>' .PHP_EOL. "</body>" .PHP_EOL. "</html>" .PHP_EOL."";
            if (file_put_contents($uploadUserMainFilename, $uploadUserMainContent) !== false) {
                echo "uploadmain PHP file created successfully";
            } else {
                echo "Error creating uploadmain PHP file";
            }

            $uploadEsuArchiveFilename = "uploadesuarchive/" . $_POST['table_name'] . ".php";
            $uploadEsuArchiveContent = "<?php" . PHP_EOL . "session_set_cookie_params(0);" . PHP_EOL . "session_start();" . PHP_EOL . "@include '../../config.php';" . PHP_EOL . "@include '../../inactivity.php';" . PHP_EOL . "if(!isset(\$_SESSION['username']))" . PHP_EOL . "{" . PHP_EOL . "    header('location:../../login.php');" . PHP_EOL . "}" . PHP_EOL . "" . PHP_EOL . "elseif(\$_SESSION['usertype']=='User')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../user/');" . PHP_EOL . "}" . PHP_EOL . "elseif(\$_SESSION['usertype']=='Admin')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../admin/');" . PHP_EOL . "}" . PHP_EOL . "\$file_id=\$_GET['uploadid'];" . PHP_EOL . "?>" . PHP_EOL .
                "<!DOCTYPE html>" . PHP_EOL . "<html>" . PHP_EOL . "<?php include '../includes/uploadheader.php';?>" . PHP_EOL . "<body>" . PHP_EOL . "<section class='dashboard'>" . PHP_EOL . "    <div class='top'>" . PHP_EOL . "        <i class='bi bi-list sidebar-toggle'></i>" . PHP_EOL . "        <div class='search-box'>" . PHP_EOL . "            <i class='bi bi-person' style='font-size: 1.5rem; color: rgb(255, 0, 0);'></i>" . PHP_EOL . "            <input type='text' placeholder='<?php echo 'Welcome, ' . \$_SESSION['username'] . '! | ' . \$_SESSION['usertype'];?>' disabled>" . PHP_EOL . "        </div>" . PHP_EOL . "    </div>" . PHP_EOL . "    <div class='dash-content'>" . PHP_EOL . "        <div class='overview'>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='studprofile'>" . PHP_EOL . "            <a href='javascript:history.back()' style='display: inline-block;'>" . PHP_EOL . "                <button type='button' class='button'>" . PHP_EOL . "                    <span class='button__text'>Back</span>" . PHP_EOL . "                    <span class='button__icon'><svg xmlns='http://www.w3.org/2000/svg' width='24' viewBox='0 0 24 24' stroke-width='2' stroke-linejoin='round' stroke-linecap='round' stroke='currentColor' height='24' fill='none' class='svg'><polyline points='15 18 9 12 15 6'></polyline></svg></span>" . PHP_EOL .
                "                </button>" . PHP_EOL . "            </a>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='stud-image' align='center'>" . PHP_EOL . "            <img src='../../lib/img/user.png'>" . PHP_EOL . "            <?php" . PHP_EOL . "            @include '../../config.php';" . PHP_EOL . "            \$id=\$_GET['uploadid'];" . PHP_EOL . '            $select="select * from esu_archive where id=$id";' . PHP_EOL . "            \$result = mysqli_query(\$conn, \$select);" .PHP_EOL . "                 if(\$result){" .PHP_EOL . "                     while(\$row=mysqli_fetch_assoc(\$result)){" .PHP_EOL . "                        \$lname = \$row['lname'];" .PHP_EOL. "                        \$fname = \$row['fname'];" .PHP_EOL. "                        \$mname = \$row['mname'];" .PHP_EOL. "                        \$courname = \$row['courname'];" .PHP_EOL. "                        echo '" .PHP_EOL. "                        <p><b>'.\$lname.', '.\$fname.' '.\$mname.'</b></p>" .PHP_EOL. "                        <p><b>'.\$courname.'</b></p>" .PHP_EOL. "                        ';" .PHP_EOL. "                     }" .PHP_EOL. "                    }" .PHP_EOL. "                ?>" .PHP_EOL. "                <p>MAIN CAMPUS</p>" .PHP_EOL. "                <br>  " .PHP_EOL.  "                <p><b>($name)</b></p> " .PHP_EOL.'        <form action="" method="post" enctype="multipart/form-data" id="uploadForm">' .PHP_EOL. '                <input type="hidden" name="file_id" id="file_id" required value="<?php echo $id ?>">' .PHP_EOL. '                <input class="form-control" type="file" name="image" id="image" required/>' .PHP_EOL. $input = '<input type="hidden" name="username" value="<?php echo $_SESSION[\'username\']; ?>">' . PHP_EOL.
     '<input type="hidden" name="date" id="theDate">  ' .PHP_EOL. '                <button class="buttonDownload" type="button" onclick="confirmUpload()">Upload</button>' .PHP_EOL. "        </form>" .PHP_EOL. "        </div>" .PHP_EOL. "        <style>" .PHP_EOL. ".form-label strong {" .PHP_EOL. "  font-weight: bold;" .PHP_EOL. "  font-size: 1.2em;" .PHP_EOL. "  color: #333;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".form-control {" .PHP_EOL. "  display: block;" .PHP_EOL. "  width: 20%;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  line-height: 1.5;" .PHP_EOL. "  color: #495057;" .PHP_EOL. "  background-color: #fff;" .PHP_EOL. "  border: 1px solid #ced4da;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".form-control:focus {" .PHP_EOL. "  border-color: #80bdff;" .PHP_EOL. "  outline: 0;" .PHP_EOL. "  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);" .PHP_EOL. "}" .PHP_EOL. 'input[type="file"] {' .PHP_EOL. "  display: block;" .PHP_EOL. "  width: 20%;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  line-height: 1.5;" .PHP_EOL. "  color: #495057;" .PHP_EOL. "  background-color: #fff;" .PHP_EOL. "  border: 1px solid #ced4da;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "  box-shadow: none;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. 'input[type="file"]::-webkit-file-upload-button {' .PHP_EOL. "  background-color: crimson;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  border: none;" .PHP_EOL. "  color: #fff;" .PHP_EOL. "  cursor: pointer;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  transition: background-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "}" .PHP_EOL.
        'input[type="file"]::-webkit-file-upload-button:hover {' .PHP_EOL. "  background-color: black;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. 'input[type="file"]::-webkit-file-upload-button:focus {' .PHP_EOL. "  outline: none;" .PHP_EOL. "  box-shadow: none;" .PHP_EOL. "}" .PHP_EOL. ".buttonDownload {" .PHP_EOL. "  display: inline-block;" .PHP_EOL. "  position: relative;" .PHP_EOL. "  padding: 10px 25px;" .PHP_EOL. "  background-color: crimson;" .PHP_EOL. "  color: white;" .PHP_EOL. "  font-family: sans-serif;" .PHP_EOL. "  text-decoration: none;" .PHP_EOL. "  font-size: 0.9em;" .PHP_EOL. "  text-align: center;" .PHP_EOL. "  text-indent: 15px;" .PHP_EOL. "  border: none;" .PHP_EOL. "  border-radius: 0.3em;" .PHP_EOL. "  font-weight: bold;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover {" .PHP_EOL. "  color: white;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:before, .buttonDownload:after {" .PHP_EOL. "  content: ' ';" .PHP_EOL. "  display: block;" .PHP_EOL. "  position: absolute;" .PHP_EOL. "  left: 15px;" .PHP_EOL. "  top: 52%;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:before {" .PHP_EOL. "  width: 10px;" .PHP_EOL. "  height: 2px;" .PHP_EOL. "  border-style: solid;" .PHP_EOL. "  border-width: 0 2px 2px;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:after {" .PHP_EOL. "  width: 0;" .PHP_EOL. "  height: 0;" .PHP_EOL. "  margin-left: 3px;" .PHP_EOL. "  margin-top: -7px;" .PHP_EOL. "  border-style: solid;" .PHP_EOL. "  border-width: 4px 4px 0 4px;" .PHP_EOL. "  border-color: transparent;" .PHP_EOL. "  border-top-color: inherit;" .PHP_EOL. "  animation: downloadArrow 1s linear infinite;" .PHP_EOL. "  animation-play-state: paused;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover:before {" .PHP_EOL. "  border-color: white;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover:after {" .PHP_EOL. "  border-top-color: white;" .PHP_EOL. "  animation-play-state: running;" .PHP_EOL.
            "}" .PHP_EOL. " " .PHP_EOL. "@keyframes downloadArrow {" .PHP_EOL. "  0% {" .PHP_EOL. "    margin-top: -7px;" .PHP_EOL. "    opacity: 1;" .PHP_EOL. "  }" .PHP_EOL. " " .PHP_EOL. "  0.001% {" .PHP_EOL. "    margin-top: -15px;" .PHP_EOL. "    opacity: 0.4;" .PHP_EOL. "  }" .PHP_EOL. "  50% {" .PHP_EOL. "    opacity: 1;" .PHP_EOL. "  }" .PHP_EOL. "  100% {" .PHP_EOL. "    margin-top: 0;" .PHP_EOL. "    opacity: 0.4;" .PHP_EOL. "  }" .PHP_EOL. "}" .PHP_EOL. "</style>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. '    <div class="row">' .PHP_EOL. '        <div class="col-xs-8 col-xs-offset-2">' .PHP_EOL. "        <?php" .PHP_EOL. " " .PHP_EOL. 'if(isset($_FILES["image"])) {' .PHP_EOL. '    $image = $_FILES["image"];' .PHP_EOL. '    $file_id = $_POST["file_id"];' .PHP_EOL. '    $username = $_POST["username"];' .PHP_EOL. "    \$date = \$_POST['date'];" .PHP_EOL. '    $name = $image["name"];' .PHP_EOL. '    $type = $image["type"];' .PHP_EOL. " " .PHP_EOL. '    if($type != "application/pdf" && $type != "image/jpeg") {' .PHP_EOL. $script = 'echo \'<script src="../../lib/JS/sweetalert.min.js"></script>\';' . PHP_EOL. $script = '        echo "<script>";' . PHP_EOL. $script = '        echo "swal({' . PHP_EOL. "            title: 'Error!'," .PHP_EOL. "            text: 'Only PDF and JPEG files are allowed.', " .PHP_EOL. "            icon: 'error' " .PHP_EOL. "        }).then(function() {" .PHP_EOL. "            window.history.back();" .PHP_EOL. '        });";' .PHP_EOL. '        echo "</script>";' .PHP_EOL. "        exit();" .PHP_EOL. "    }" .PHP_EOL. " " .PHP_EOL. '    $blob = addslashes(file_get_contents($image["tmp_name"]));' .PHP_EOL. $sql = "       \$sql = \"INSERT INTO `" . $tableName . "` (`image`, `file_id`, `username`, `date`, `name`, `type`) VALUES ('\" . \$blob . \"', '\" . \$file_id . \"' , '\" . \$username . \"', '\" . \$date . \"', '\" . \$name . \"' , '\" . \$type . \"')\";" . PHP_EOL. "    mysqli_query(\$conn, \$sql) or die(mysqli_error(\$conn));" .PHP_EOL. $script = 'echo \'<script src="../../lib/JS/sweetalert.min.js"></script>\';' . PHP_EOL. $script = '        echo "<script>";' . PHP_EOL. $script = '        echo "swal({' . PHP_EOL. "        title: 'Success!', " .PHP_EOL. "        text: 'File has been uploaded.', " .PHP_EOL. "        icon: 'success' " .PHP_EOL. "    }).then(function() {" .PHP_EOL. "        window.history.back();" .PHP_EOL. '    });";' .PHP_EOL. '    echo "</script>";' .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. $sql = "\$sql = \"SELECT id, name FROM `" . $tableName . "` WHERE file_id=\$file_id\";" . PHP_EOL. '$result = mysqli_query($conn, $sql);' .PHP_EOL. "?>" .PHP_EOL.  '<script src="../../lib/JS/sweetalert.min.js"></script>' .PHP_EOL. "<script>" .PHP_EOL. "function confirmUpload() {" .PHP_EOL. "    swal({" .PHP_EOL. '        title: "Confirmation",' .PHP_EOL. '        text: "Are you sure you want to upload the file?",' .PHP_EOL. '        icon: "warning",' .PHP_EOL. '        buttons: ["Cancel", "Upload"],' .PHP_EOL. "        dangerMode: true," .PHP_EOL. "    }).then(function (willUpload) {" .PHP_EOL. "        if (willUpload) {" .PHP_EOL. '            document.getElementById("uploadForm").submit();' .PHP_EOL. "        } else {" .PHP_EOL. "            swal({" .PHP_EOL. '                title: "Cancelled",' .PHP_EOL. '                text: "File upload has been cancelled.",' .PHP_EOL. '                icon: "info",' .PHP_EOL. "            });" .PHP_EOL. "        }" .PHP_EOL. "    });" .PHP_EOL. '' .PHP_EOL. "}" .PHP_EOL. "</script>" .PHP_EOL." " .PHP_EOL. '<table class="content-table">' .PHP_EOL. "    <thead>" .PHP_EOL. "        <tr>" .PHP_EOL. "            <th>File Name</th>" .PHP_EOL. "            <th>View</th>" .PHP_EOL. "            <th>Delete</th>" .PHP_EOL. "        </tr>" .PHP_EOL. "    </thead>" .PHP_EOL. "    <tbody>" .PHP_EOL. "        <?php" .PHP_EOL. '        while ($row = mysqli_fetch_object($result))' .PHP_EOL. "        {" .PHP_EOL.
                "            ?>" .PHP_EOL. "            <tr>" .PHP_EOL. '                <td><?php echo $row->name; ?></td>' .PHP_EOL. "                <td>" .PHP_EOL. "                   <a href=\"../views/$tableName.php?id=<?php echo \$row->id; ?>\" target=\"_blank\"> ".PHP_EOL. '                        <buttons class="btn-button">VIEW</buttons>' .PHP_EOL. "                    </a>" .PHP_EOL. "                </td>" .PHP_EOL. "            <td>" .PHP_EOL. "                <a class=\"btn-button\" href=\"delete/delete_$tableName.php?id=<?php echo \$row->id; ?>\" onclick=\"showConfirmation(event)\">DELETE</a>" .PHP_EOL. "            </td>" .PHP_EOL. "            </tr>" .PHP_EOL. "            <?php" .PHP_EOL. "        }" .PHP_EOL. "        ?>" .PHP_EOL. "    </tbody>" .PHP_EOL. "</table>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. "</div>" .PHP_EOL. "</section>" .PHP_EOL."<script>" .PHP_EOL. "    function showConfirmation(event) {" .PHP_EOL. "        event.preventDefault();" .PHP_EOL. " " .PHP_EOL. "        swal({" .PHP_EOL. "            title: 'Are you sure?'," .PHP_EOL. "            text: 'This action cannot be undone.'," .PHP_EOL. "            icon: 'warning'," .PHP_EOL. "            buttons: {" .PHP_EOL. "                cancel: {" .PHP_EOL. "                    text: 'Cancel'," .PHP_EOL. "                    value: null," .PHP_EOL. "                   visible: true," .PHP_EOL. "                    className: ''," .PHP_EOL. "                    closeModal: true," .PHP_EOL. "                }," .PHP_EOL. "                confirm: {" .PHP_EOL. "                    text: 'Yes, delete it!'," .PHP_EOL. "                    value: true," .PHP_EOL. "                    visible: true," .PHP_EOL. "                    className: ''," .PHP_EOL. "                    closeModal: true" .PHP_EOL. 
                    "                }" .PHP_EOL. "            }" .PHP_EOL. "        }).then(function (willDelete) {" .PHP_EOL. "            if (willDelete) {" .PHP_EOL. "                window.location.href = event.target.href;" .PHP_EOL. "                showSuccessMessage();" .PHP_EOL. "            }" .PHP_EOL. "        });" .PHP_EOL. "    }" .PHP_EOL. " " .PHP_EOL. "    function showSuccessMessage() {" .PHP_EOL. "        swal({" .PHP_EOL. "            title: 'Deleted!'," .PHP_EOL. "            text: 'The record has been deleted successfully.'," .PHP_EOL. "            icon: 'success'," .PHP_EOL. "            timer: 2000," .PHP_EOL. "            buttons: false," .PHP_EOL. "        }).then(function () {" .PHP_EOL. "            window.location.href = 'birth.php';" .PHP_EOL. "        });" .PHP_EOL. "    }" .PHP_EOL. "</script>" .PHP_EOL. "<script>" .PHP_EOL. "    var date = new Date();" .PHP_EOL. "var day = date.getDate();" .PHP_EOL. "var month = date.getMonth() + 1;" .PHP_EOL. "var year = date.getFullYear();" .PHP_EOL. " " .PHP_EOL. 'if (month < 10) month = "0" + month;' .PHP_EOL. 'if (day < 10) day = "0" + day;' .PHP_EOL. " " .PHP_EOL. 'var today = year + "-" + month + "-" + day; ' .PHP_EOL. 'document.getElementById("theDate").value = today;' .PHP_EOL. "</script>" .PHP_EOL. "<script>" .PHP_EOL. '    const form = document.querySelector("form"),' .PHP_EOL. '        nextBtn = form.querySelector(".nextBtn"),' .PHP_EOL. '        backBtn = form.querySelector(".backBtn"),' .PHP_EOL. '        allInput = form.querySelectorAll(".first input");' .PHP_EOL. " " .PHP_EOL. 'nextBtn.addEventListener("click", ()=> {' .PHP_EOL. "    allInput.forEach(input => {" .PHP_EOL. '        if(input.value != ""){' .PHP_EOL. "            form.classList.add('secActive');" .PHP_EOL. "        }else{" .PHP_EOL. "            form.classList.remove('secActive');" .PHP_EOL. "        }" .PHP_EOL. "    })" .PHP_EOL. "})" .PHP_EOL. " " .PHP_EOL. "backBtn.addEventListener(\"click\", () => form.classList.remove('secActive'));" .PHP_EOL. "</script> " .PHP_EOL. '<script src="../../lib/JS/script.js"></script>' .PHP_EOL. "</body>" .PHP_EOL. "</html>" .PHP_EOL."";
                if (file_put_contents($uploadEsuArchiveFilename, $uploadEsuArchiveContent) !== false) {
                    echo "uploadmain PHP file created successfully";
                } else {
                    echo "Error creating uploadmain PHP file";
                }
            
            $uploadAdminEsuArchiveFilename = "../admin/uploadesuarchive/" . $_POST['table_name'] . ".php";
            $uploadAdminEsuArchiveContent = "<?php" . PHP_EOL . "session_set_cookie_params(0);" . PHP_EOL . "session_start();" . PHP_EOL . "@include '../../config.php';" . PHP_EOL . "@include '../../inactivity.php';" . PHP_EOL . "if(!isset(\$_SESSION['username']))" . PHP_EOL . "{" . PHP_EOL . "    header('location:../../login.php');" . PHP_EOL . "}" . PHP_EOL . "" . PHP_EOL . "elseif(\$_SESSION['usertype']=='User')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../user/');" . PHP_EOL . "}" . PHP_EOL . "elseif(\$_SESSION['usertype']=='HeadAdmin')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../head/');" . PHP_EOL . "}" . PHP_EOL . "\$file_id=\$_GET['uploadid'];" . PHP_EOL . "?>" . PHP_EOL .
                    "<!DOCTYPE html>" . PHP_EOL . "<html>" . PHP_EOL . "<?php include '../includes/uploadheader.php';?>" . PHP_EOL . "<body>" . PHP_EOL . "<section class='dashboard'>" . PHP_EOL . "    <div class='top'>" . PHP_EOL . "        <i class='bi bi-list sidebar-toggle'></i>" . PHP_EOL . "        <div class='search-box'>" . PHP_EOL . "            <i class='bi bi-person' style='font-size: 1.5rem; color: rgb(255, 0, 0);'></i>" . PHP_EOL . "            <input type='text' placeholder='<?php echo 'Welcome, ' . \$_SESSION['username'] . '! | ' . \$_SESSION['usertype'];?>' disabled>" . PHP_EOL . "        </div>" . PHP_EOL . "    </div>" . PHP_EOL . "    <div class='dash-content'>" . PHP_EOL . "        <div class='overview'>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='studprofile'>" . PHP_EOL . "            <a href='javascript:history.back()' style='display: inline-block;'>" . PHP_EOL . "                <button type='button' class='button'>" . PHP_EOL . "                    <span class='button__text'>Back</span>" . PHP_EOL . "                    <span class='button__icon'><svg xmlns='http://www.w3.org/2000/svg' width='24' viewBox='0 0 24 24' stroke-width='2' stroke-linejoin='round' stroke-linecap='round' stroke='currentColor' height='24' fill='none' class='svg'><polyline points='15 18 9 12 15 6'></polyline></svg></span>" . PHP_EOL .
                    "                </button>" . PHP_EOL . "            </a>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='stud-image' align='center'>" . PHP_EOL . "            <img src='../../lib/img/user.png'>" . PHP_EOL . "            <?php" . PHP_EOL . "            @include '../../config.php';" . PHP_EOL . "            \$id=\$_GET['uploadid'];" . PHP_EOL . '            $select="select * from esu_archive where id=$id";' . PHP_EOL . "            \$result = mysqli_query(\$conn, \$select);" .PHP_EOL . "                 if(\$result){" .PHP_EOL . "                     while(\$row=mysqli_fetch_assoc(\$result)){" .PHP_EOL . "                        \$lname = \$row['lname'];" .PHP_EOL. "                        \$fname = \$row['fname'];" .PHP_EOL. "                        \$mname = \$row['mname'];" .PHP_EOL. "                        \$courname = \$row['courname'];" .PHP_EOL. "                        echo '" .PHP_EOL. "                        <p><b>'.\$lname.', '.\$fname.' '.\$mname.'</b></p>" .PHP_EOL. "                        <p><b>'.\$courname.'</b></p>" .PHP_EOL. "                        ';" .PHP_EOL. "                     }" .PHP_EOL. "                    }" .PHP_EOL. "                ?>" .PHP_EOL. "                <p>MAIN CAMPUS</p>" .PHP_EOL. "                <br>  " .PHP_EOL.  "                <p><b>($name)</b></p> " .PHP_EOL.'        <form action="" method="post" enctype="multipart/form-data" id="uploadForm">' .PHP_EOL. '                <input type="hidden" name="file_id" id="file_id" required value="<?php echo $id ?>">' .PHP_EOL. '                <input class="form-control" type="file" name="image" id="image" required/>' .PHP_EOL. $input = '<input type="hidden" name="username" value="<?php echo $_SESSION[\'username\']; ?>">' . PHP_EOL.
         '<input type="hidden" name="date" id="theDate">  ' .PHP_EOL. '                <button class="buttonDownload" type="button" onclick="confirmUpload()">Upload</button>' .PHP_EOL. "        </form>" .PHP_EOL. "        </div>" .PHP_EOL. "        <style>" .PHP_EOL. ".form-label strong {" .PHP_EOL. "  font-weight: bold;" .PHP_EOL. "  font-size: 1.2em;" .PHP_EOL. "  color: #333;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".form-control {" .PHP_EOL. "  display: block;" .PHP_EOL. "  width: 20%;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  line-height: 1.5;" .PHP_EOL. "  color: #495057;" .PHP_EOL. "  background-color: #fff;" .PHP_EOL. "  border: 1px solid #ced4da;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".form-control:focus {" .PHP_EOL. "  border-color: #80bdff;" .PHP_EOL. "  outline: 0;" .PHP_EOL. "  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);" .PHP_EOL. "}" .PHP_EOL. 'input[type="file"] {' .PHP_EOL. "  display: block;" .PHP_EOL. "  width: 20%;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  line-height: 1.5;" .PHP_EOL. "  color: #495057;" .PHP_EOL. "  background-color: #fff;" .PHP_EOL. "  border: 1px solid #ced4da;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "  box-shadow: none;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. 'input[type="file"]::-webkit-file-upload-button {' .PHP_EOL. "  background-color: crimson;" .PHP_EOL. "  border-radius: 0.25rem;" .PHP_EOL. "  border: none;" .PHP_EOL. "  color: #fff;" .PHP_EOL. "  cursor: pointer;" .PHP_EOL. "  font-size: 1rem;" .PHP_EOL. "  padding: 0.5rem 0.75rem;" .PHP_EOL. "  transition: background-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;" .PHP_EOL. "}" .PHP_EOL.
            'input[type="file"]::-webkit-file-upload-button:hover {' .PHP_EOL. "  background-color: black;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. 'input[type="file"]::-webkit-file-upload-button:focus {' .PHP_EOL. "  outline: none;" .PHP_EOL. "  box-shadow: none;" .PHP_EOL. "}" .PHP_EOL. ".buttonDownload {" .PHP_EOL. "  display: inline-block;" .PHP_EOL. "  position: relative;" .PHP_EOL. "  padding: 10px 25px;" .PHP_EOL. "  background-color: crimson;" .PHP_EOL. "  color: white;" .PHP_EOL. "  font-family: sans-serif;" .PHP_EOL. "  text-decoration: none;" .PHP_EOL. "  font-size: 0.9em;" .PHP_EOL. "  text-align: center;" .PHP_EOL. "  text-indent: 15px;" .PHP_EOL. "  border: none;" .PHP_EOL. "  border-radius: 0.3em;" .PHP_EOL. "  font-weight: bold;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover {" .PHP_EOL. "  color: white;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:before, .buttonDownload:after {" .PHP_EOL. "  content: ' ';" .PHP_EOL. "  display: block;" .PHP_EOL. "  position: absolute;" .PHP_EOL. "  left: 15px;" .PHP_EOL. "  top: 52%;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:before {" .PHP_EOL. "  width: 10px;" .PHP_EOL. "  height: 2px;" .PHP_EOL. "  border-style: solid;" .PHP_EOL. "  border-width: 0 2px 2px;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:after {" .PHP_EOL. "  width: 0;" .PHP_EOL. "  height: 0;" .PHP_EOL. "  margin-left: 3px;" .PHP_EOL. "  margin-top: -7px;" .PHP_EOL. "  border-style: solid;" .PHP_EOL. "  border-width: 4px 4px 0 4px;" .PHP_EOL. "  border-color: transparent;" .PHP_EOL. "  border-top-color: inherit;" .PHP_EOL. "  animation: downloadArrow 1s linear infinite;" .PHP_EOL. "  animation-play-state: paused;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover:before {" .PHP_EOL. "  border-color: white;" .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. ".buttonDownload:hover:after {" .PHP_EOL. "  border-top-color: white;" .PHP_EOL. "  animation-play-state: running;" .PHP_EOL.
                "}" .PHP_EOL. " " .PHP_EOL. "@keyframes downloadArrow {" .PHP_EOL. "  0% {" .PHP_EOL. "    margin-top: -7px;" .PHP_EOL. "    opacity: 1;" .PHP_EOL. "  }" .PHP_EOL. " " .PHP_EOL. "  0.001% {" .PHP_EOL. "    margin-top: -15px;" .PHP_EOL. "    opacity: 0.4;" .PHP_EOL. "  }" .PHP_EOL. "  50% {" .PHP_EOL. "    opacity: 1;" .PHP_EOL. "  }" .PHP_EOL. "  100% {" .PHP_EOL. "    margin-top: 0;" .PHP_EOL. "    opacity: 0.4;" .PHP_EOL. "  }" .PHP_EOL. "}" .PHP_EOL. "</style>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. '    <div class="row">' .PHP_EOL. '        <div class="col-xs-8 col-xs-offset-2">' .PHP_EOL. "        <?php" .PHP_EOL. " " .PHP_EOL. 'if(isset($_FILES["image"])) {' .PHP_EOL. '    $image = $_FILES["image"];' .PHP_EOL. '    $file_id = $_POST["file_id"];' .PHP_EOL. '    $username = $_POST["username"];' .PHP_EOL. "    \$date = \$_POST['date'];" .PHP_EOL. '    $name = $image["name"];' .PHP_EOL. '    $type = $image["type"];' .PHP_EOL. " " .PHP_EOL. '    if($type != "application/pdf" && $type != "image/jpeg") {' .PHP_EOL. $script = 'echo \'<script src="../../lib/JS/sweetalert.min.js"></script>\';' . PHP_EOL. $script = '        echo "<script>";' . PHP_EOL. $script = '        echo "swal({' . PHP_EOL. "            title: 'Error!'," .PHP_EOL. "            text: 'Only PDF and JPEG files are allowed.', " .PHP_EOL. "            icon: 'error' " .PHP_EOL. "        }).then(function() {" .PHP_EOL. "            window.history.back();" .PHP_EOL. '        });";' .PHP_EOL. '        echo "</script>";' .PHP_EOL. "        exit();" .PHP_EOL. "    }" .PHP_EOL. " " .PHP_EOL. '    $blob = addslashes(file_get_contents($image["tmp_name"]));' .PHP_EOL. $sql = "       \$sql = \"INSERT INTO `" . $tableName . "` (`image`, `file_id`, `username`, `date`, `name`, `type`) VALUES ('\" . \$blob . \"', '\" . \$file_id . \"' , '\" . \$username . \"', '\" . \$date . \"', '\" . \$name . \"' , '\" . \$type . \"')\";" . PHP_EOL. "    mysqli_query(\$conn, \$sql) or die(mysqli_error(\$conn));" .PHP_EOL. $script = 'echo \'<script src="../../lib/JS/sweetalert.min.js"></script>\';' . PHP_EOL. $script = '        echo "<script>";' . PHP_EOL. $script = '        echo "swal({' . PHP_EOL. "        title: 'Success!', " .PHP_EOL. "        text: 'File has been uploaded.', " .PHP_EOL. "        icon: 'success' " .PHP_EOL. "    }).then(function() {" .PHP_EOL. "        window.history.back();" .PHP_EOL. '    });";' .PHP_EOL. '    echo "</script>";' .PHP_EOL. "}" .PHP_EOL. " " .PHP_EOL. $sql = "\$sql = \"SELECT id, name FROM `" . $tableName . "` WHERE file_id=\$file_id\";" . PHP_EOL. '$result = mysqli_query($conn, $sql);' .PHP_EOL. "?>" .PHP_EOL.  '<script src="../../lib/JS/sweetalert.min.js"></script>' .PHP_EOL. "<script>" .PHP_EOL. "function confirmUpload() {" .PHP_EOL. "    swal({" .PHP_EOL. '        title: "Confirmation",' .PHP_EOL. '        text: "Are you sure you want to upload the file?",' .PHP_EOL. '        icon: "warning",' .PHP_EOL. '        buttons: ["Cancel", "Upload"],' .PHP_EOL. "        dangerMode: true," .PHP_EOL. "    }).then(function (willUpload) {" .PHP_EOL. "        if (willUpload) {" .PHP_EOL. '            document.getElementById("uploadForm").submit();' .PHP_EOL. "        } else {" .PHP_EOL. "            swal({" .PHP_EOL. '                title: "Cancelled",' .PHP_EOL. '                text: "File upload has been cancelled.",' .PHP_EOL. '                icon: "info",' .PHP_EOL. "            });" .PHP_EOL. "        }" .PHP_EOL. "    });" .PHP_EOL. '' .PHP_EOL. "}" .PHP_EOL. "</script>" .PHP_EOL." " .PHP_EOL. '<table class="content-table">' .PHP_EOL. "    <thead>" .PHP_EOL. "        <tr>" .PHP_EOL. "            <th>File Name</th>" .PHP_EOL. "            <th>View</th>" .PHP_EOL."        </tr>" .PHP_EOL. "    </thead>" .PHP_EOL. "    <tbody>" .PHP_EOL. "        <?php" .PHP_EOL. '        while ($row = mysqli_fetch_object($result))' .PHP_EOL. "        {" .PHP_EOL.
                    "            ?>" .PHP_EOL. "            <tr>" .PHP_EOL. '                <td><?php echo $row->name; ?></td>' .PHP_EOL. "                <td>" .PHP_EOL. "                   <a href=\"../views/$tableName.php?id=<?php echo \$row->id; ?>\" target=\"_blank\"> ".PHP_EOL. '                        <buttons class="btn-button">VIEW</buttons>' .PHP_EOL. "                    </a>" .PHP_EOL. "                </td>" .PHP_EOL."            </tr>" .PHP_EOL. "            <?php" .PHP_EOL. "        }" .PHP_EOL. "        ?>" .PHP_EOL. "    </tbody>" .PHP_EOL. "</table>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. "</div>" .PHP_EOL. "</section>" .PHP_EOL. "<script>" .PHP_EOL. "    var date = new Date();" .PHP_EOL. "var day = date.getDate();" .PHP_EOL. "var month = date.getMonth() + 1;" .PHP_EOL. "var year = date.getFullYear();" .PHP_EOL. " " .PHP_EOL. 'if (month < 10) month = "0" + month;' .PHP_EOL. 'if (day < 10) day = "0" + day;' .PHP_EOL. " " .PHP_EOL. 'var today = year + "-" + month + "-" + day; ' .PHP_EOL. 'document.getElementById("theDate").value = today;' .PHP_EOL. "</script>" .PHP_EOL. "<script>" .PHP_EOL. '    const form = document.querySelector("form"),' .PHP_EOL. '        nextBtn = form.querySelector(".nextBtn"),' .PHP_EOL. '        backBtn = form.querySelector(".backBtn"),' .PHP_EOL. '        allInput = form.querySelectorAll(".first input");' .PHP_EOL. " " .PHP_EOL. 'nextBtn.addEventListener("click", ()=> {' .PHP_EOL. "    allInput.forEach(input => {" .PHP_EOL. '        if(input.value != ""){' .PHP_EOL. "            form.classList.add('secActive');" .PHP_EOL. "        }else{" .PHP_EOL. "            form.classList.remove('secActive');" .PHP_EOL. "        }" .PHP_EOL. "    })" .PHP_EOL. "})" .PHP_EOL. " " .PHP_EOL. "backBtn.addEventListener(\"click\", () => form.classList.remove('secActive'));" .PHP_EOL. "</script> " .PHP_EOL. '<script src="../../lib/JS/script.js"></script>' .PHP_EOL. "</body>" .PHP_EOL. "</html>" .PHP_EOL."";
                    if (file_put_contents($uploadAdminEsuArchiveFilename, $uploadAdminEsuArchiveContent) !== false) {
                        echo "uploadmain PHP file created successfully";
                    } else {
                        echo "Error creating uploadmain PHP file";
                    }
    
            $uploadUserEsuArchiveFilename = "../user/uploadesuarchive/" . $_POST['table_name'] . ".php";
            $uploadUserEsuArchiveContent = "<?php" . PHP_EOL . "session_set_cookie_params(0);" . PHP_EOL . "session_start();" . PHP_EOL . "@include '../../config.php';" . PHP_EOL . "@include '../../inactivity.php';" . PHP_EOL . "if(!isset(\$_SESSION['username']))" . PHP_EOL . "{" . PHP_EOL . "    header('location:../../login.php');" . PHP_EOL . "}" . PHP_EOL . "" . PHP_EOL . "elseif(\$_SESSION['usertype']=='HeadAdmin')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../head/');" . PHP_EOL . "}" . PHP_EOL . "elseif(\$_SESSION['usertype']=='Admin')" . PHP_EOL . "{" . PHP_EOL . "    header('Location: ../../admin/');" . PHP_EOL . "}" . PHP_EOL . "\$file_id=\$_GET['uploadid'];" . PHP_EOL . "?>" . PHP_EOL .
                "<!DOCTYPE html>" . PHP_EOL . "<html>" . PHP_EOL . "<?php include '../includes/uploadheader.php';?>" . PHP_EOL . "<body>" . PHP_EOL . "<section class='dashboard'>" . PHP_EOL . "    <div class='top'>" . PHP_EOL . "        <i class='bi bi-list sidebar-toggle'></i>" . PHP_EOL . "        <div class='search-box'>" . PHP_EOL . "            <i class='bi bi-person' style='font-size: 1.5rem; color: rgb(255, 0, 0);'></i>" . PHP_EOL . "            <input type='text' placeholder='<?php echo 'Welcome, ' . \$_SESSION['username'] . '! | ' . \$_SESSION['usertype'];?>' disabled>" . PHP_EOL . "        </div>" . PHP_EOL . "    </div>" . PHP_EOL . "    <div class='dash-content'>" . PHP_EOL . "        <div class='overview'>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='studprofile'>" . PHP_EOL . "            <a href='javascript:history.back()' style='display: inline-block;'>" . PHP_EOL . "                <button type='button' class='button'>" . PHP_EOL . "                    <span class='button__text'>Back</span>" . PHP_EOL . "                    <span class='button__icon'><svg xmlns='http://www.w3.org/2000/svg' width='24' viewBox='0 0 24 24' stroke-width='2' stroke-linejoin='round' stroke-linecap='round' stroke='currentColor' height='24' fill='none' class='svg'><polyline points='15 18 9 12 15 6'></polyline></svg></span>" . PHP_EOL .
                "                </button>" . PHP_EOL . "            </a>" . PHP_EOL . "        </div>" . PHP_EOL . "        <div class='stud-image' align='center'>" . PHP_EOL . "            <img src='../../lib/img/user.png'>" . PHP_EOL . "            <?php" . PHP_EOL . "            @include '../../config.php';" . PHP_EOL . "            \$id=\$_GET['uploadid'];" . PHP_EOL . '            $select="select * from esu_archive where id=$id";' . PHP_EOL . "            \$result = mysqli_query(\$conn, \$select);" .PHP_EOL . "                 if(\$result){" .PHP_EOL . "                     while(\$row=mysqli_fetch_assoc(\$result)){" .PHP_EOL . "                        \$lname = \$row['lname'];" .PHP_EOL. "                        \$fname = \$row['fname'];" .PHP_EOL. "                        \$mname = \$row['mname'];" .PHP_EOL. "                        \$courname = \$row['courname'];" .PHP_EOL. "                        echo '" .PHP_EOL. "                        <p><b>'.\$lname.', '.\$fname.' '.\$mname.'</b></p>" .PHP_EOL. "                        <p><b>'.\$courname.'</b></p>" .PHP_EOL. "                        ';" .PHP_EOL. "                     }" .PHP_EOL. "                    }" .PHP_EOL. "                ?>" .PHP_EOL. "                <p>MAIN CAMPUS</p>" .PHP_EOL. "                <br>  " .PHP_EOL.  "                <p><b>($name)</b></p> " .PHP_EOL. "        </div>" .PHP_EOL."        </div>" .PHP_EOL. "    </div>" .PHP_EOL. '    <div class="row">' .PHP_EOL. '        <div class="col-xs-8 col-xs-offset-2">' .PHP_EOL. "<?php" .PHP_EOL. $sql = "\$sql = \"SELECT id, name FROM `" . $tableName . "` WHERE file_id=\$file_id\";" . PHP_EOL. '$result = mysqli_query($conn, $sql);' .PHP_EOL. "?>" .PHP_EOL." " .PHP_EOL. '<table class="content-table">' .PHP_EOL. "    <thead>" .PHP_EOL. "        <tr>" .PHP_EOL. "            <th>File Name</th>" .PHP_EOL. "            <th>View</th>" .PHP_EOL. "        </tr>" .PHP_EOL. "    </thead>" .PHP_EOL. "    <tbody>" .PHP_EOL. "        <?php" .PHP_EOL. '        while ($row = mysqli_fetch_object($result))' .PHP_EOL. "        {" .PHP_EOL.
                "            ?>" .PHP_EOL. "            <tr>" .PHP_EOL. '                <td><?php echo $row->name; ?></td>' .PHP_EOL. "                <td>" .PHP_EOL. "                   <a href=\"../views/$tableName.php?id=<?php echo \$row->id; ?>\" target=\"_blank\"> ".PHP_EOL. '                        <buttons class="btn-button">VIEW</buttons>' .PHP_EOL. "                    </a>" .PHP_EOL. "                </td>" .PHP_EOL."            </tr>" .PHP_EOL. "            <?php" .PHP_EOL. "        }" .PHP_EOL. "        ?>" .PHP_EOL. "    </tbody>" .PHP_EOL. "</table>" .PHP_EOL. "        </div>" .PHP_EOL. "    </div>" .PHP_EOL. "</div>" .PHP_EOL. "</section>" .PHP_EOL. "<script>" .PHP_EOL. "    var date = new Date();" .PHP_EOL. "var day = date.getDate();" .PHP_EOL. "var month = date.getMonth() + 1;" .PHP_EOL. "var year = date.getFullYear();" .PHP_EOL. " " .PHP_EOL. 'if (month < 10) month = "0" + month;' .PHP_EOL. 'if (day < 10) day = "0" + day;' .PHP_EOL. " " .PHP_EOL. 'var today = year + "-" + month + "-" + day; ' .PHP_EOL. 'document.getElementById("theDate").value = today;' .PHP_EOL. "</script>" .PHP_EOL. "<script>" .PHP_EOL. '    const form = document.querySelector("form"),' .PHP_EOL. '        nextBtn = form.querySelector(".nextBtn"),' .PHP_EOL. '        backBtn = form.querySelector(".backBtn"),' .PHP_EOL. '        allInput = form.querySelectorAll(".first input");' .PHP_EOL. " " .PHP_EOL. 'nextBtn.addEventListener("click", ()=> {' .PHP_EOL. "    allInput.forEach(input => {" .PHP_EOL. '        if(input.value != ""){' .PHP_EOL. "            form.classList.add('secActive');" .PHP_EOL. "        }else{" .PHP_EOL. "            form.classList.remove('secActive');" .PHP_EOL. "        }" .PHP_EOL. "    })" .PHP_EOL. "})" .PHP_EOL. " " .PHP_EOL. "backBtn.addEventListener(\"click\", () => form.classList.remove('secActive'));" .PHP_EOL. "</script> " .PHP_EOL. '<script src="../../lib/JS/script.js"></script>' .PHP_EOL. "</body>" .PHP_EOL. "</html>" .PHP_EOL."";
                if (file_put_contents($uploadUserEsuArchiveFilename, $uploadUserEsuArchiveContent) !== false) {
                    echo "uploadmain PHP file created successfully";
                } else {
                    echo "Error creating uploadmain PHP file";
                }
            
        $deleteFilename = "uploadesu/delete/delete_" . $_POST['table_name'] . ".php";
        $deleteContent = "<?php" . PHP_EOL . 'include "../../../config.php";' .PHP_EOL. " " .PHP_EOL. "if (isset(\$_GET['id'])) {" .PHP_EOL. "    \$id = \$_GET['id'];" .PHP_EOL. "    \$sql = \"DELETE FROM `$tableName` WHERE `id` = \" . \$_GET[\"id\"];" .PHP_EOL. "    \$conn->query(\$sql);" .PHP_EOL. " " .PHP_EOL. " " .PHP_EOL. "    \$_SESSION['delete_success'] = true;" .PHP_EOL. "}" .PHP_EOL. "header('location: ' . \$_SERVER['HTTP_REFERER']);" .PHP_EOL. "exit;" .PHP_EOL. "?>" .PHP_EOL."";     
        if (file_put_contents($deleteFilename, $deleteContent) !== false) {
            echo "delete PHP file created successfully";
        } else {
            echo "Error creating delete PHP file";
        }   
        
        $deleteEsuArchiveFilename = "uploadesuarchive/delete/delete_" . $_POST['table_name'] . ".php";
        $deleteEsuArchiveContent = "<?php" . PHP_EOL . 'include "../../../config.php";' .PHP_EOL. " " .PHP_EOL. "if (isset(\$_GET['id'])) {" .PHP_EOL. "    \$id = \$_GET['id'];" .PHP_EOL. "    \$sql = \"DELETE FROM `$tableName` WHERE `id` = \" . \$_GET[\"id\"];" .PHP_EOL. "    \$conn->query(\$sql);" .PHP_EOL. " " .PHP_EOL. " " .PHP_EOL. "    \$_SESSION['delete_success'] = true;" .PHP_EOL. "}" .PHP_EOL. "header('location: ' . \$_SERVER['HTTP_REFERER']);" .PHP_EOL. "exit;" .PHP_EOL. "?>" .PHP_EOL."";     
        if (file_put_contents($deleteEsuArchiveFilename, $deleteEsuArchiveContent) !== false) {
            echo "delete PHP file created successfully";
        } else {
            echo "Error creating delete PHP file";
        }
    
        // Generate a new PHP file for views
        $viewsFilename = "views/" . $_POST['table_name'] . ".php";
        $viewsContent = '<?php' . PHP_EOL . '@include "../../config.php";' . PHP_EOL . $sql = "\$sql = \"SELECT * FROM `" . $tableName . "` WHERE `id` = {\$_GET['id']}\";" . PHP_EOL.        '$result = mysqli_query($conn, $sql);' . PHP_EOL . 'if(mysqli_num_rows($result) ==0)' . PHP_EOL .
        '{' . PHP_EOL . 'die("File does not exist.");' . PHP_EOL . '}' . PHP_EOL . '$row = mysqli_fetch_object($result);' . PHP_EOL . 'if($row->type == "application/pdf"){' . PHP_EOL . '    header("content-type: application/pdf");' . PHP_EOL . '    echo($row->image);' . PHP_EOL . '} else if ($row->type == "image/jpeg"){' . PHP_EOL .
            '    header("Content-Type: application/octet-stream");' . PHP_EOL . '    header("Content-Disposition: attachment; filename=BirthCertificate.jpg");' . PHP_EOL . '    echo $row->image;' . PHP_EOL . '} else {' . PHP_EOL . '    die("Invalid file type.");' . PHP_EOL . '}' . PHP_EOL .'?>';
        if (file_put_contents($viewsFilename, $viewsContent) !== false) {
            echo "views PHP file created successfully";
        } else {
            echo "Error creating views PHP file";
        }

        $viewsAdminFilename = "../admin/views/" . $_POST['table_name'] . ".php";
        $viewsAdminContent = '<?php' . PHP_EOL . '@include "../../config.php";' . PHP_EOL . $sql = "\$sql = \"SELECT * FROM `" . $tableName . "` WHERE `id` = \" . \$_GET[\"id\"];" . PHP_EOL.        '$result = mysqli_query($conn, $sql);' . PHP_EOL . 'if(mysqli_num_rows($result) ==0)' . PHP_EOL .
        '{' . PHP_EOL . 'die("File does not exist.");' . PHP_EOL . '}' . PHP_EOL . '$row = mysqli_fetch_object($result);' . PHP_EOL . 'if($row->type == "application/pdf"){' . PHP_EOL . '    header("content-type: application/pdf");' . PHP_EOL . '    echo($row->image);' . PHP_EOL . '} else if ($row->type == "image/jpeg"){' . PHP_EOL .
            '    header("Content-Type: application/octet-stream");' . PHP_EOL . '    header("Content-Disposition: attachment; filename=BirthCertificate.jpg");' . PHP_EOL . '    echo $row->image;' . PHP_EOL . '} else {' . PHP_EOL . '    die("Invalid file type.");' . PHP_EOL . '}' . PHP_EOL .'?>';
        if (file_put_contents($viewsAdminFilename, $viewsAdminContent) !== false) {
            echo "views PHP file created successfully";
        } else {
            echo "Error creating views PHP file";
        }
    
    $viewsUserFilename = "../user/views/" . $_POST['table_name'] . ".php";
        $viewsUserContent = '<?php' . PHP_EOL . '@include "../../config.php";' . PHP_EOL . $sql = "\$sql = \"SELECT * FROM `" . $tableName . "` WHERE `id` = \" . \$_GET[\"id\"];" . PHP_EOL.        '$result = mysqli_query($conn, $sql);' . PHP_EOL . 'if(mysqli_num_rows($result) ==0)' . PHP_EOL .
        '{' . PHP_EOL . 'die("File does not exist.");' . PHP_EOL . '}' . PHP_EOL . '$row = mysqli_fetch_object($result);' . PHP_EOL . 'if($row->type == "application/pdf"){' . PHP_EOL . '    header("content-type: application/pdf");' . PHP_EOL . '    echo($row->image);' . PHP_EOL . '} else if ($row->type == "image/jpeg"){' . PHP_EOL .
            '    header("Content-Type: application/octet-stream");' . PHP_EOL . '    header("Content-Disposition: attachment; filename=BirthCertificate.jpg");' . PHP_EOL . '    echo $row->image;' . PHP_EOL . '} else {' . PHP_EOL . '    die("Invalid file type.");' . PHP_EOL . '}' . PHP_EOL .'?>';
        if (file_put_contents($viewsUserFilename, $viewsUserContent) !== false) {
            echo "views PHP file created successfully";
        } else {
            echo "Error creating views PHP file";
        }
    } else {
        echo "Error creating table: " . $conn->error;
    }
    


    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        $name = $_POST['name'];
        $href = $_POST['href'];
        $archHref = $_POST['Archhref'];
        $tblname = $_POST['tblname'];
    
        // Save the new row to the database or perform any other necessary actions
        // Example: Insert the new row into the `table_main` table
        $insert_query = "INSERT INTO `table_esu` (name, href, tblname) VALUES ('$name', '$href', '$tblname')";
        $insert_result = mysqli_query($conn, $insert_query);
    
        if ($insert_result) {
            // Get the ID of the newly inserted row
            $id = mysqli_insert_id($conn);
    
            // Insert the new row into the `table_mainarchive` table
            $insert_archive_query = "INSERT INTO `table_esuarchive` (name, href, tblname) VALUES ('$name', '$archHref', '$tblname')";
            $insert_archive_result = mysqli_query($conn, $insert_archive_query);
    
            if ($insert_archive_result) {
                // Redirect to the main.php page
                header("Location: esu.php");
                exit();
            } else {
                // Error inserting into table_mainarchive
                echo "<script>alert('Error adding row to table_mainarchive!')</script>";
            }
        } else {
            // Error adding row
            echo "<script>alert('Error adding row to table_main!')</script>";
        }
    }
    
    // Close the connection
    $conn->close();
}
?>
</div>

</body>
</html>